<script type="text/javascript">
  RED.nodes.registerType('discordInteractionManager', {
    category: 'Discord · Responses',
    color: '#7289da',
    defaults: {
      name: { value: "", required: false },
      token: { value: "", required: true, type: "discord-token" }
    },
    inputs: 1,
    outputs: 1,
    icon: "font-awesome/fa-share-square-o",
    paletteLabel: 'Discord Interaction Manager',
    label: function () {
      return this.name || "Discord Interaction Manager";
    }
  });
</script>
<script type="text/x-red" data-template-name="discordInteractionManager">
    <div class="form-row">
        <label for="node-input-token"><i class="icon-tag"></i> token</label>
        <input type="text" id="node-input-token" placeholder="token">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="discordInteractionManager">
  <p><strong>What it does</strong> — Sends the official reply back to Discord for slash commands, buttons, select menus, modals, and autocomplete prompts. It keeps the interaction token valid and prevents the dreaded “This interaction failed” banner.</p>
  <p><strong>When to use it</strong> — Immediately after a <code>discordInteraction</code> node. Use it for the initial defer/update/reply and for follow-up edits to the same interaction.</p>

  <h3>Key inputs</h3>
  <dl class="message-properties">
    <dt>action <span class="property-type">string</span></dt>
    <dd>How to respond. Supported values: <code>reply</code>, <code>edit</code>, <code>followup</code>, <code>editFollowup</code>, <code>delete</code>, <code>showModal</code>, <code>respondAutocomplete</code>. Defaults to <code>edit</code> so you can modify a deferred reply.</dd>
    <dt>interactionId <span class="property-type">string | number</span></dt>
    <dd>The id from <code>discordInteraction</code>. Pass the whole <code>msg</code> forward and it is filled in for you.</dd>
    <dt>payload <span class="property-type">string</span></dt>
    <dd>The text body of your reply.</dd>
    <dt>embeds / components <span class="property-type">object | array</span></dt>
    <dd>Optional embed or component definitions to include with the response.</dd>
    <dt>attachments <span class="property-type">string | object | array</span></dt>
    <dd>Files to upload with the interaction response. Objects support <code>name</code>, <code>description</code>, <code>spoiler</code>, and audio clip <code>duration</code>/<code>durationMs</code>.</dd>
    <dt class="optional">ephemeral <span class="property-type">boolean</span></dt>
    <dd>When <code>true</code>, <code>reply</code> and <code>followup</code> actions send the message only to the invoking user.</dd>
    <dt class="optional">suppressEmbeds / suppressNotifications <span class="property-type">boolean</span></dt>
    <dd>Set to <code>true</code> to hide link previews or send the message without pinging everyone.</dd>
    <dt>autoCompleteChoices <span class="property-type">array</span></dt>
    <dd>Only for autocomplete requests: an array of choices Discord should show the user.</dd>
  </dl>

  <h3>What comes out</h3>
  <dl class="message-properties">
    <dt>payload <span class="property-type">object</span></dt>
    <dd>The message returned by Discord (for updates and replies). Autocomplete responses resolve with basic status info.</dd>
  </dl>

  <h3>Tips</h3>
  <ul>
    <li>Always send this node within 3 seconds for initial replies (or defer first) to avoid timeouts.</li>
    <li>Set the “Ephemeral” checkbox in <code>discordInteraction</code> for deferred command replies, or pass <code>msg.ephemeral = true</code> here for ad-hoc replies and follow-ups.</li>
    <li>Need multiple follow-ups? Use the <code>followup</code> action; the helper returns the created message so you can call <code>editFollowup</code> or <code>delete</code> later.</li>
    <li>Set <code>msg.suppressEmbeds</code> or <code>msg.suppressNotifications</code> to control message flags on the reply.</li>
    <li>Provide alt text or clip metadata through the attachment object when you need richer uploads.</li>
  </ul>
</script>
