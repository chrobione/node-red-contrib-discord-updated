<script type="text/javascript">
  RED.nodes.registerType('discordReactionManager', {
    category: 'discord ¬∑ event intake',
    color: '#7289da',
    defaults: {
      name: {
        value: "",
        required: false
      },
      token: {
        value: "",
        required: true,
        type: "discord-token"
      }
    },
    inputs: 1,
    outputs: 1,
    icon: "font-awesome/fa-smile-o",
    label: function () {
      return this.name || "discordReactionManager";
    }
  });
</script>
<script type="text/x-red" data-template-name="discordReactionManager">
  <div class="form-row">
        <label for="node-input-token"><i class="icon-tag"></i> token</label>
        <input type="text" id="node-input-token" placeholder="token">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="discordReactionManager">
  <p><strong>What it does</strong> ‚Äî Watches a single Discord message and reports every emoji reaction that people add or remove. Treat it like a live poll reader for that message.</p>
  <p><strong>When to use it</strong> ‚Äî Great for reaction-role systems, quick votes, or keeping track of how many üëç your announcement collects.</p>

  <h3>Inputs you send</h3>
  <dl class="message-properties">
    <dt>message <span class="property-type">object | string</span></dt>
    <dd>The target message. Pass the full message object (for best results) or just its id.</dd>
    <dt>channel <span class="property-type">object | string</span></dt>
    <dd>The channel that holds the message. Needed so the node can look the message up again.</dd>
    <dt class="optional">time <span class="property-type">number</span></dt>
    <dd>How long to keep listening, in milliseconds. Leave blank to use the 10 minute default.</dd>
  </dl>

  <h3>What comes out</h3>
  <dl class="message-properties">
    <dt>payload <span class="property-type">string</span></dt>
    <dd>The emoji that was pressed (Unicode or custom emoji name).</dd>
    <dt>count <span class="property-type">number</span></dt>
    <dd>How many people have used that emoji so far.</dd>
    <dt>message <span class="property-type">object</span></dt>
    <dd>The message we are monitoring, so you can reference it later.</dd>
    <dt>user <span class="property-type">object</span></dt>
    <dd>The user who just reacted.</dd>
    <dt>_originalFlowMessage <span class="property-type">object</span></dt>
    <dd>Whatever you originally injected into this node (handy if you need extra context).</dd>
  </dl>

  <h3>Tips</h3>
  <ul>
    <li>After Node-RED restarts you must send the message/channel info again so the watcher can reattach.</li>
    <li>Wire the output into a switch node keyed on <code>msg.payload</code> to handle different emoji choices.</li>
    <li>Combine the <code>count</code> value with dashboard nodes to build a quick poll leaderboard.</li>
  </ul>
</script>
