a<script type="text/javascript">
  RED.nodes.registerType('discordMessageManager', {
    category: 'Discord ¬∑ Responses',
    color: '#7289da',
    defaults: {
      name: {
        value: "",
        required: false
      },
      channel: {
        value: null,
        required: false
      },
      token: {
        value: "",
        required: true,
        type: "discord-token"
      }
    },
    inputs: 1,
    outputs: 1,
    icon: "font-awesome/fa-paper-plane",
    paletteLabel: 'Discord Message Manager',
    label: function () {
      return this.name || "Discord Message Manager";
    }
  });
</script>
<script type="text/x-red" data-template-name="discordMessageManager">
  <div class="form-row">
        <label for="node-input-token"><i class="icon-tag"></i> token</label>
        <input type="text" id="node-input-token" placeholder="token">
    </div>
    <div class="form-row">
        <label for="node-input-channel"><i class="icon-tag"></i> Channel</label>
        <input type="text" id="node-input-channel" name="ch" placeholder="Channel ID">
        <p>(leave 'channel' blank to use <code>msg.channel</code> as channel ID to send to)</p>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>
<script type="text/x-red" data-help-name="discordMessageManager">
  <p><strong>What it does</strong> ‚Äî Sends or edits regular Discord messages (text, embeds, attachments) in channels or DMs. It can also delete, react to, or look up existing messages.</p>
  <p><strong>When to use it</strong> ‚Äî Any message that is not a direct interaction reply. For slash-command responses use <code>discordInteractionManager</code> first, then this node for follow-up messages if you need them.</p>

  <h3>Key inputs</h3>
  <dl class="message-properties">
    <dt>action <span class="property-type">string</span></dt>
    <dd>What to do: <code>create</code>, <code>edit</code>, <code>delete</code>, <code>reply</code>, <code>react</code>, <code>crosspost</code>, <code>search</code>, or <code>info</code>. Defaults to <code>create</code>.</dd>
    <dt>payload <span class="property-type">string</span></dt>
    <dd>The text body of the message. Required for create/edit/reply.</dd>
    <dt>channel <span class="property-type">object | string</span></dt>
    <dd>The target channel (object or id). Needed for channel posts, edits, deletes, search, and info.</dd>
    <dt>user <span class="property-type">object | string</span></dt>
    <dd>Use instead of <code>channel</code> when you want to DM the user.</dd>
    <dt>message <span class="property-type">object | string</span></dt>
    <dd>The message you want to edit, delete, react to, or inspect.</dd>
    <dt>embeds / components <span class="property-type">object | array</span></dt>
    <dd>Embed or component payloads that accompany the message.</dd>
    <dt class="optional">suppressEmbeds / suppressNotifications <span class="property-type">boolean</span></dt>
    <dd>Set to <code>true</code> to hide link previews or send the message silently (Discord feature flag).</dd>
    <dt>attachments <span class="property-type">string | object | array</span></dt>
    <dd>File URLs or buffer objects to upload alongside the message. Objects can set <code>name</code>, <code>description</code>, <code>spoiler</code>, and <code>duration</code>/<code>durationMs</code> for audio clips.</dd>
    <dt class="optional">deleteFilter <span class="property-type">object</span></dt>
    <dd>For <code>action="bulkdelete"</code>: controls which messages are removed (e.g. <code>limit</code>, <code>author</code>, <code>includePinned</code>, <code>olderThan</code>/<code>youngerThan</code>).</dd>
    <dt class="optional">deleteConfirm <span class="property-type">boolean</span></dt>
    <dd>Must be <code>true</code> to enable bulk deletion.</dd>
  </dl>

  <h3>What comes out</h3>
  <dl class="message-properties">
    <dt>payload <span class="property-type">object | array</span></dt>
    <dd>The message Discord returned. For searches this becomes an array of messages.</dd>
    <dt>request <span class="property-type">object</span></dt>
    <dd>Your original input message so you can continue the flow.</dd>
  </dl>

  <h3>Tips</h3>
  <ul>
    <li><code>create</code> needs <code>msg.payload</code> plus either <code>msg.channel</code> or <code>msg.user</code>.</li>
    <li>For edits or deletes, set <code>msg.message</code> to the original message object/id and include the channel.</li>
    <li>Use <code>react</code> with <code>msg.payload</code> set to an emoji name such as <code>üëç</code> or <code>my_custom:123456</code>.</li>
    <li>Attachments from URLs are not validated; make sure the link is reachable or Discord will refuse it.</li>
    <li>Add accessibility text with <code>description</code>, mark spoilers with <code>spoiler: true</code>, and include clip length via <code>duration</code> (seconds) or <code>durationMs</code>.</li>
    <li>Set <code>msg.suppressEmbeds</code> or <code>msg.suppressNotifications</code> (or add them inside <code>msg.payload</code>) to control Discord‚Äôs message flags.</li>
    <li>Components support buttons (type 2) plus select menus for strings, users, roles, mentionables, and channels (types 3, 5, 6, 7, 8).</li>
    <li>Bulk deletes obey Discord‚Äôs 14-day limit; anything older is removed one-by-one. Always set <code>msg.deleteConfirm = true</code> to acknowledge the action.</li>
  </ul>
</script>
